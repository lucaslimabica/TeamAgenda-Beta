!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AppExtensionsSDK=t()}(this,function(){"use strict";function e(e,t,i,n){return new(i||(i=Promise))(function(o,s){function a(e){try{d(n.next(e))}catch(e){s(e)}}function r(e){try{d(n.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,r)}d((n=n.apply(e,t||[])).next())})}var t,i,n,o,s,a,r,d,c,l;"function"==typeof SuppressedError&&SuppressedError,function(e){e.SHOW_SNACKBAR="show_snackbar",e.SHOW_CONFIRMATION="show_confirmation",e.RESIZE="resize",e.INITIALIZE="initialize",e.OPEN_MODAL="open_modal",e.CLOSE_MODAL="close_modal",e.GET_SIGNED_TOKEN="get_signed_token",e.REDIRECT_TO="redirect_to",e.SHOW_FLOATING_WINDOW="show_floating_window",e.HIDE_FLOATING_WINDOW="hide_floating_window",e.SET_NOTIFICATION="set_notification",e.SET_FOCUS_MODE="set_focus_mode",e.GET_METADATA="get_metadata"}(t||(t={})),function(e){e.VISIBILITY="visibility",e.CLOSE_CUSTOM_MODAL="close_custom_modal",e.PAGE_VISIBILITY_STATE="page_visibility_state",e.USER_SETTINGS_CHANGE="user_settings_change"}(i||(i={})),function(e){e.COMMAND="command",e.LISTENER="listener",e.TRACK="track"}(n||(n={})),function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.NEGATIVE="negative"}(o||(o={})),function(e){e.DEAL="deal",e.ORGANIZATION="organization",e.PERSON="person",e.ACTIVITY="activity",e.JSON_MODAL="json_modal",e.CUSTOM_MODAL="custom_modal"}(s||(s={})),function(e){e.CLOSED="closed",e.SUBMITTED="submitted"}(a||(a={})),function(e){e.FOCUSED="focused"}(r||(r={})),function(e){e.USER="user",e.COMMAND="command"}(d||(d={})),function(e){e.DARK="dark",e.LIGHT="light"}(c||(c={})),function(e){e.DEALS="deals",e.LEADS="leads",e.ORGANIZATIONS="organizations",e.CONTACTS="contacts",e.CAMPAIGNS="campaigns",e.PROJECTS="projects",e.SETTINGS="settings"}(l||(l={}));const u=Object.values(t),E=Object.values(i);return Object.assign(class{constructor(e={}){const{identifier:t,targetWindow:i}=e;if(this.initialized=!1,this.window=null!=i?i:window.parent,this.identifier=null!=t?t:new URLSearchParams(window.location.search).get("id"),this.userSettings={theme:new URLSearchParams(window.location.search).get("theme")===c.DARK?c.DARK:c.LIGHT},!this.identifier)throw new Error("Missing custom UI identifier");!function(e){let t=!1;null===window||void 0===window||window.addEventListener("focus",()=>{t||e(),t=!0}),null===window||void 0===window||window.addEventListener("blur",()=>{t=!1})}(()=>{this.track(r.FOCUSED)})}postMessage(e,t="*"){return new Promise((i,n)=>{const o=new MessageChannel,s={payload:e,id:this.identifier};o.port1.onmessage=({data:e})=>{o.port1.close();const{error:t,data:s}=e;t?n(new Error(t)):i(s)},this.window.postMessage(s,t,[o.port2])})}execute(e,...t){if(!this.initialized)throw new Error("SDK is not initialized");if(!u.includes(e))throw new Error("Invalid command");return this.postMessage({command:e,args:t[0],type:n.COMMAND})}track(e,t="*"){const i={payload:{type:n.TRACK,event:e},id:this.identifier};this.window.postMessage(i,t)}onPageVisibilityChange(e){const t=()=>{e({data:{state:document.visibilityState}})};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)}listen(e,t){if(!E.includes(e))throw new Error("Invalid event");if(e===i.PAGE_VISIBILITY_STATE)return this.onPageVisibilityChange(t);const o=new MessageChannel,s={payload:{type:n.LISTENER,event:e},id:this.identifier};return o.port1.onmessage=({data:n})=>{n.error&&o.port1.close(),t(n),e===i.USER_SETTINGS_CHANGE&&n&&(this.userSettings=n)},this.window.postMessage(s,"*",[o.port2]),()=>{o.port1.close()}}setWindow(e){this.window=e}initialize(i={}){return e(this,void 0,void 0,function*(){return yield this.postMessage({command:t.INITIALIZE,args:i,type:n.COMMAND}),this.initialized=!0,this})}},{Command:t,Event:i,Modal:s,ModalStatus:a,Color:o,TrackingEvent:r,MessageType:n,View:l,VisibilityEventInvoker:d})});
//# sourceMappingURL=index.umd.js.map
